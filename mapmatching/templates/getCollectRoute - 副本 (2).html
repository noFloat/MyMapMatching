<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width">
    <title>Data Collection</title>
    <link rel="stylesheet" href="http://cache.amap.com/lbs/static/main1119.css"/>
    <script type="text/javascript" src="http://webapi.amap.com/maps?v=1.3&key=6453161a20a7c6fdebe3b56d012d0223"></script>
    <script type="text/javascript" src="http://cache.amap.com/lbs/static/addToolbar.js"></script>
    
    {% load static %}
    <link href="{% static 'bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">
    <script src="{% static 'jquery-3.2.1.min.js' %}"></script>
    <script src="{% static 'bootstrap/js/bootstrap.min.js' %}"></script>
</head>
<body>

    <div class="row" style="width:100%;">
        <nav class="navbar navbar-inverse navbar-fixed-top" style="width:100%">
          <div class="container">
            <div class="navbar-header">
              <a class="navbar-brand" href="#">Paper Experiment Data Collection</a>
            </div>
          </div>
        </nav>
    </div>
    <div class="row" style="height:80%; margin-top: 50px;">
      <div class="col-md-6" style="height:100%;">
            <div id="container2" style="width:100%; height:100%;">
            </div>
      </div>
      <div class="col-md-6">
            <div class="jumbotron">
                <div class="container">
                    <h1>Thanks!</h1>
                    <h5>亲爱的同学你好呀，看你我有缘，能否在此稍作停留，大概也就是5分钟的事啦</h5>
                    <h5>我们想做一个主观性的实验来验证一些想法，大概意思就是利用你的历史行为来优化一下导航生成的导航路径和导航语言（个性化服务），所以想收集一点数据~</h5>
                    <h5>左边地图上的路线可以随意拖动，以此来代表你的真实历史行为~</h5>
                    <h5>点击发送就可以保存下来辣~ 我们希望 英俊/靓丽 的你可以画20条左右~</h5>
                    <h5>画出的各个路径之间还是不要隔得太远了（e.g. 一条在城南一条在城北 这数据就太稀疏啦）</h5>
                    <h5>之后我们会拿优化好的路径来询问一下您的感受了啦 (我觉得OK or 我觉得不OK or 无话可说) </h5>
                </div>
            </div>
            <div class="input-group" style="width:50%;">
              <span class="input-group-addon" id="basic-addon1">@</span>
              <input type="text" class="form-control" placeholder="输一个昵称啦 例如：胖虎" aria-describedby="basic-addon1" id = "username">
            </div>
            <div style="width:50%;margin-top: 10px;">
            <button type="button" class="btn btn-success" onclick="sendData()" style="float:right;">发送您的轨迹</button>
            </div>

            <div style="width:50%;margin-top: 10px;" id="eggs">

            </div>
            
      </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="myModal_1" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel_1">Modal title</h4>
          </div>
          <div class="modal-body" id="myModalbody_1">
            1111111111111111111111111111111111111111111111111111111
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="myModal_2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel_2">Modal title</h4>
          </div>
          <div class="modal-body" id="myModalbody_2">
            <div id="carousel-example-generic" class="carousel slide" data-ride="carousel">
                  <!-- Indicators -->
                  <ol class="carousel-indicators">
                    <li data-target="#carousel-example-generic" data-slide-to="0" class="active"></li>
                    <li data-target="#carousel-example-generic" data-slide-to="1"></li>
                    <li data-target="#carousel-example-generic" data-slide-to="2"></li>
                  </ol>

                  <!-- Wrapper for slides -->
                  <div class="carousel-inner" role="listbox">
                    <div class="item active">
                      <img src="" id="img1">
                    </div>
                    <div class="item">
                      <img src="" id="img2">
                    </div>
                    <div class="item">
                      <img src="" id="img3">
                    </div>
                  </div>

                  <!-- Controls -->
                  <a class="left carousel-control" href="#carousel-example-generic" role="button" data-slide="prev">
                    <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                  </a>
                  <a class="right carousel-control" href="#carousel-example-generic" role="button" data-slide="next">
                    <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                  </a>
                </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="myModal_3" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel_3">Modal title</h4>
          </div>
          <div class="modal-body" id="myModalbody_3">
            1111111111111111111111111111111111111111111111111111111
          </div>
          <div style="text-align:right;padding-right: 20px; margin-bottom: 10px;">
              <button type="button" id="answerButton" data-loading-text="Loading..." class="btn btn-primary" autocomplete="off">
                  需要答案
              </button>
          </div>
          <div id="answer_div" style="padding:10px">
            1231231231231231231231231323
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="myModal_4" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel_4">Modal title</h4>
          </div>
          <div class="modal-body" id="myModalbody_4">
            1111111111111111111111111111111111111111111111111111111
          </div>
          <div style="text-align:right;padding-right: 20px; margin-bottom: 10px;">
            <div class="input-group" style="width:50%;margin-left: 20px;">
              <span class="input-group-addon" id="basic-addon1">@</span>
              <input type="text" class="form-control" placeholder="输一个昵称啦 例如：胖虎" aria-describedby="basic-addon1" id = "username2">
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal" onclick="sendName()">Send</button>
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>



</body>

<script type="text/javascript">
    var map, route, marker;
    //基本地图加载
    map = new AMap.Map("container2", {
        resizeEnable: true
    });
    //绘制初始路径
    var path = [];
    path.push([103.923872, 30.752172]);
    path.push([104.014086, 30.66796]);
    map.plugin("AMap.DragRoute", function() {
        route = new AMap.DragRoute(map, path, AMap.DrivingPolicy.LEAST_FEE); //构造拖拽导航类
        route.search(); //查询导航路径并开启拖拽导航

    });


</script>

<script type="text/javascript">
    var eggs;
    function sendData()
    {
        var username = $("#username").val();
        if(username.length == 0){
            alert("不写名字 我看你简直是在为难我胖虎")
        }
        else if(username.length >= 20){
            alert("这么长的名字 我看你简直是在为难我胖虎")
        }
        else{
            data = route.getRoute();
            var send_information = {username : username , gps : data}
            //alert(typeof(data)); //data是个GPS对的列表对象
            jstring_data = JSON.stringify(send_information) //转成string

            //alert(typeof(json_data))
            //alert(data[0])
            //发送数据
            $.ajax({
                        async: false,
                        type:"POST",
                        url:"{% url 'saveGPX' %}",
                        contentType:"application/json; charset=utf-8",
                        data: jstring_data,
                        dataType: "json",
                        success: function (message) {
                           if(message != 'ok'){
                               eggs = message
                               var category = message.category
                               $("#eggs").empty();
                               var string = "<button class=\"btn btn-primary btn-lg\" data-toggle=\"modal\" data-target=\"#myModal_"+category+"\" id=\"egg_button\" onclick=\"display()\">谢谢大佬，开个彩蛋压压惊吧</button>";
                               $('#eggs').prepend(string);
                               $('#myModalLabel_'+category).empty()
                               $('#myModalLabel_'+category).prepend(eggs.title)
                               
                               switch(category){
                                    case 1:
                                        $('#myModalbody_'+category).empty()
                                        $('#myModalbody_'+category).prepend(eggs.description)
                                    case 2:
                                        $('#img1').attr({"src":"{% static 'image/' %}"+ message.imgsrc1}) 
                                        $('#img2').attr({"src":"{% static 'image/' %}"+ message.imgsrc2})
                                        $('#img3').attr({"src":"{% static 'image/' %}"+ message.imgsrc3}) 
                                        break;
                                    case 3:
                                        $('#myModalbody_'+category).empty()
                                        $('#myModalbody_'+category).prepend(eggs.description)
                                        $("#answer_div").html(eggs.answer)
                                        $("#answer_div").fadeOut();

                                        break;
                                    case 4:
                                        $('#myModalbody_'+category).empty()
                                        $('#myModalbody_'+category).prepend(eggs.description)

                                        break;
                               }

                               alert("提交成功，谢谢大佬，好人一生平安");
                           }
                           else{
                                $("#eggs").empty();
                                alert("提交成功，谢谢大佬，好人一生平安");
                            }
                           //alert(message)
                           console.log("success");  
                        
                           
                        },
                        error: function (message) {
                           console.log("error");  
                           
                        }
                    });
            
        }
        //alert(route.getRoute());
        //alert(username);
    };

</script>

<script>
  $('#answerButton').on('click', function () {
    var $btn = $(this).button('loading');
    $("#answer_div").fadeIn();
    // business logic...
    $btn.button('reset')
  })

  function display(){
    $("#eggs").empty();
    // business logic...
    //$btn.button('reset')
  }

  function sendName(){
    var username2 = $("#username2").val();
    $.ajax({
            async: false,
            type:"POST",
            url:"{% url 'sendName' %}",
            contentType:"application/json; charset=utf-8",
            data: username2,
            dataType: "json",
            success: function (message) {},
            error: function (message) {}
    });
  }
</script>

</html>